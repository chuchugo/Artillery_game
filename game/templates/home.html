<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
 	<script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
        crossorigin="anonymous"></script>   
    <title> Document </title>
</head>



<canvas id="trajectory-canvas" width="1000" height="500" 
    style = "position:relative; left:50px; top:50px; background-color:yellow;"></canvas>
    <script>
    var balldata=[];
    var refreshIntervalId=null;
    $.ajax({
        url: '/game/get-trajectory-data',
        success: function(data) {
            // The data is a dictionary of timestamp -> position
            // The position is a dictionary of x and y coordinates
             // Start the animation
            refreshIntervalId = setInterval(function(){updateBallPosition(data)}, 1000*0.1);
        }
    });
 
    var canvas = document.getElementById('trajectory-canvas');
    var ctx = canvas.getContext('2d');
    var ballRadius = 10;
    var currentFrame = 0;
    var timeStep = 1000 / 30;
    var currentDataIndex = 1;

    function updateBallPosition(ballData) {

    var currentData  = ballData[currentDataIndex];
    // Calculate the position of the ball based on the time elapsed
    var t = currentData.t;
    var x = currentData.x / 2; 
    var y = 500 - currentData.y / 2; 
    console.log("t","x",x,"y",y)
    // Clear the canvas
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Draw the ball at the new position
    ctx.beginPath();
    ctx.arc(x, y, ballRadius, 0, 2 * Math.PI);
    ctx.fill();

    // Update the currentDataIndex if we've reached the end of the data
    currentDataIndex += 1;
    var length = Object.keys(ballData).length;
    
    if (currentDataIndex >= length) {
        clearInterval(refreshIntervalId);
        console.log("cleared interval",refreshIntervalId)
    }
    }
     </script>
</canvas>
</html>